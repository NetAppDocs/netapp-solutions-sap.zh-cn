---
sidebar: sidebar 
permalink: backup/anf-cba-backup-and-recovery-using-azure-netapp-files.html 
keywords: runtime, backup, recovery, restore, recover 
summary: '您可以使用Azure NetApp Files (ANF) Snapshot技术在几秒钟内创建数据库备份。创建 Snapshot 副本所需的时间与数据库大小无关，因为 Snapshot 副本不会移动存储平台上的任何物理数据块。此外，使用 Snapshot 技术不会影响实时 SAP 系统的性能。' 
---
= 使用Azure NetApp Files 进行备份和恢复
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./../media/


link:anf-cba-overview.html["上一步：概述。"]

[role="lead"]
您可以使用Azure NetApp Files (ANF) Snapshot技术在几秒钟内创建数据库备份。创建 Snapshot 副本所需的时间与数据库大小无关，因为 Snapshot 副本不会移动存储平台上的任何物理数据块。此外，使用 Snapshot 技术不会影响实时 SAP 系统的性能。因此，您可以计划创建 Snapshot 副本，而无需考虑对话峰值或批处理活动期间。基于ANF的SAP客户通常会在一天内计划多个联机Snapshot备份；例如、每四到六小时通常会有一次。这些 Snapshot 备份通常会在主存储系统上保留三到五天，然后再被删除。

Snapshot 副本还为还原和恢复操作提供了主要优势。通过卷还原操作，可以根据可用的 Snapshot 副本将整个数据库还原到任意时间点。无论数据库大小如何，此类还原过程都只需几秒钟即可完成。由于在一天中会创建多个联机 Snapshot 备份，因此与传统备份方法相比，恢复过程所需的时间显著减少。由于还原操作可以使用仅使用几小时（而不是长达 24 小时）的 Snapshot 副本执行，因此必须应用较少的事务日志。因此， RTO 会减少到几分钟，而不是传统单周期备份所需的几小时。

Snapshot 副本备份与活动联机数据存储在同一磁盘系统上。因此， NetApp 建议使用 Snapshot 副本备份作为对备份到二级位置的补充，而不是替代。大多数还原和恢复操作都通过在主存储系统上使用卷还原操作来处理。只有当包含 Snapshot 副本的主存储系统损坏时，才需要从二级位置进行还原。如果需要还原 Snapshot 副本不再提供的备份，您可以使用二级位置。

您可以使用其他基于 HANA 文件的备份将数据备份到二级位置。这些基于文件的备份的计划频率可以低得多、因此对生产系统性能的影响也会小。



== Snapshot备份和还原操作的运行时

下图显示了客户使用Snapshot备份操作的HANA Studio。此图显示、使用Snapshot备份技术、HANA数据库(大小约为4 TB)可在1分20秒内完成备份、而使用基于文件的备份操作则可在4小时以上完成备份。

整个备份工作流运行时间的最大一部分是执行HANA备份保存点操作所需的时间、此步骤取决于HANA数据库上的负载。存储 Snapshot 备份本身始终会在几秒钟内完成。

image:anf-cba-image1.png["此图显示了客户使用Snapshot备份操作的HANA Studio。"]



== 恢复时间目标比较

本节将对基于文件的Snapshot备份和基于存储的Snapshot备份进行恢复时间目标(RTO)比较。RTO由还原、恢复然后启动数据库所需的时间之和定义。



=== 还原数据库所需的时间

对于基于文件的备份，还原时间取决于数据库和备份基础架构的大小，该大小定义了还原速度，以 MB/ 秒为单位。例如、如果基础架构支持以250 MBps的速度执行还原操作、则需要大约4.5小时才能在永久性的情况下还原大小为4 TB的数据库。

对于存储Snapshot副本备份、还原时间与数据库大小无关、并且始终在几秒的范围内。



=== 启动数据库所需的时间

数据库开始时间取决于数据库大小以及将数据加载到内存所需的时间。在以下示例中、假设数据可以加载1000 Mbps。将4 TB的容量加载到内存大约需要1小时10分钟。基于文件和基于Snapshot的还原和恢复操作的开始时间相同。


NOTE: 使用Azure NetApp Files 、可以动态调整卷吞吐量。在HANA启动之前、HANA数据卷的吞吐量可以在HANA数据库启动后增加、并减少为日常操作值。



=== 恢复数据库所需的时间

恢复时间取决于还原后必须应用的日志数量。此数字由执行数据备份的频率决定。

对于基于文件的数据备份，备份计划通常每天执行一次。通常不能使用较高的备份频率，因为备份会降低生产性能。因此，在最坏的情况下，在该日写入的所有日志都必须在正向恢复期间应用。

快照备份的计划频率通常较高、因为它们不会影响SAP HANA数据库的性能。例如、如果每六小时计划一次Snapshot备份、则在最坏的情况下、恢复时间将是基于文件的备份恢复时间的四分之一(6小时/24小时= 0.25)。

下图显示了还原和恢复操作与基于文件的每日备份和具有不同计划的Snapshot备份的比较。

前两个条形显示、即使每天只备份一个Snapshot、由于Snapshot备份的还原操作速度较快、还原和恢复也会减少到43%。如果每天创建多个Snapshot备份、则可以进一步减少运行时间、因为在正向恢复期间需要应用的日志更少。

下图还显示、每天有四到六个Snapshot备份最有意义、因为较高的频率不会对整体运行时间产生很大影响。

image:anf-cba-image2.png["此图显示了还原和恢复操作与基于文件的每日备份和具有不同计划的Snapshot备份的比较。"]

link:anf-cba-use-cases-and-value-of-accelerated-backup-and-cloning-operations_overview.html["接下来：加快备份和克隆操作的用例和价值。"]
