---
sidebar: sidebar 
permalink: backup/anf-cba-file-based-backup-operations-of-the-hana-database.html 
keywords: assign policy, file-based backup, cba topology, sap hana studio 
summary: 本节介绍如何完成HANA数据库的基于文件的备份操作。 
---
= HANA数据库的基于文件的备份操作
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./../media/


link:anf-cba-snapshot-based-backup-operations-of-the-hana-database.html["先前版本：HANA数据库的基于Snapshot的备份操作。"]

[role="lead"]
SAP 建议将基于存储的 Snapshot 备份与每周基于文件的备份相结合，以执行块完整性检查。Cloud Backup for Applications支持使用选择基于文件的备份作为备份类型的策略来执行块完整性检查。

除了HANA数据卷上的Snapshot备份之外、基于文件的备份还用于具有二级备份副本。如果主数据卷完全丢失，您可以使用这些基于文件的备份执行还原和恢复操作。

使用此策略计划备份时、Cloud Backup for Applications会为系统和所有租户数据库创建标准SAP HANA文件备份。



== 将策略分配给HANA系统

要激活计划的备份、必须将备份策略分配给HANA系统。

. 转至*分配策略*>*数据卷*。
+
image:anf-cba-image48.png["正在完成的步骤的屏幕截图。"]

. 选择基于文件的备份策略、然后单击*分配*。
+
image:anf-cba-image49.png["正在完成的步骤的屏幕截图。"]

. 现在、该策略已分配给HANA系统、并将根据计划定义执行基于文件的备份。




== 创建基于文件的按需备份

要创建按需数据库备份、请完成以下步骤：

. 在CBA信息板视图中、选择上下文菜单中的按需备份—数据卷。
+
image:anf-cba-image50.png["正在完成的步骤的屏幕截图。"]

. 在按需备份对话框中、选择*基于策略*或*一次*。
+
** 对于*基于策略*、按需备份与计划备份在保留以及脚本前和脚本后配置方面的处理方式相同。
** 使用*一次*、您可以定义特定保留、特定备份名称以及特定的前脚本和后脚本。


. 在我们的示例中、我们选择了基于策略、下一步将选择策略和保留。
+
image:anf-cba-image51.png["正在完成的步骤的屏幕截图。"]

. 在作业监控视图中、您可以看到不同的工作流步骤、步骤的运行时间以及总操作运行时间。
+
image:anf-cba-image52.png["正在完成的步骤的屏幕截图。"]

+
image:anf-cba-image53.png["正在完成的步骤的屏幕截图。"]





== 在CBA拓扑视图中查看基于文件的备份信息

Cloud Backup for Applications显示基于文件的备份的方式与显示基于Snapshot副本的备份的方式不同。而是仅列出最后一个基于文件的备份。基于文件的备份成功或失败可在作业监控视图中查看。

image:anf-cba-image54.png["正在完成的步骤的屏幕截图。"]



== 查看文件系统上基于文件的备份信息

成功的块完整性检查可创建标准 SAP HANA 数据备份文件。CBA使用HANA数据库中配置的备份路径执行基于文件的数据备份操作。命名约定遵循基于文件的备份的备份策略中的配置。

....
vm-pr1:/hanabackup/PR1/file # ls -al *
DB_PR1:
total 3355880
drwxr-xr-- 2 pr1adm sapsys       4096 Jan  3 10:12 .
drwxr-x--- 4 pr1adm sapsys       4096 Dec 19 13:53 ..
-rw-r----- 1 pr1adm sapsys     155648 Jan  3 10:10 SnapCenter_SnapCenter_PR1_WeeklyBlockIntegrityCheck_Weekly_2023_01_03_10_10_19_databackup_0_1
-rw-r----- 1 pr1adm sapsys   83894272 Jan  3 10:11 SnapCenter_SnapCenter_PR1_WeeklyBlockIntegrityCheck_Weekly_2023_01_03_10_10_19_databackup_2_1
-rw-r----- 1 pr1adm sapsys 1627398144 Jan  3 10:12 SnapCenter_SnapCenter_PR1_WeeklyBlockIntegrityCheck_Weekly_2023_01_03_10_10_19_databackup_3_1
SYSTEMDB:
total 3092672
drwxr-xr-- 2 pr1adm sapsys       4096 Jan  3 10:12 .
drwxr-x--- 4 pr1adm sapsys       4096 Dec 19 13:53 ..
-rw-r----- 1 pr1adm sapsys     159744 Jan  3 10:10 SnapCenter_SnapCenter_PR1_WeeklyBlockIntegrityCheck_Weekly_2023_01_03_10_10_19_databackup_0_1
-rw-r----- 1 pr1adm sapsys 1577066496 Jan  3 10:12 SnapCenter_SnapCenter_PR1_WeeklyBlockIntegrityCheck_Weekly_2023_01_03_10_10_19_databackup_1_1
vm-pr1:/hanabackup/PR1/file #
....


== 在SAP HANA Studio中查看基于文件的备份信息

SAP HANA 备份目录会显示系统数据库和租户数据库的条目。下图显示了系统数据库和租户数据库的备份目录中基于CBA文件的备份。

image:anf-cba-image55.png["下图显示了系统数据库备份目录中基于CBA文件的备份。"]

image:anf-cba-image56.png["下图显示了租户数据库备份目录中基于CBA文件的备份。"]

link:anf-cba-snapshot-based-backup-operations-of-non-data-volumes.html["接下来：对非数据卷执行基于Snapshot的备份操作。"]
