---
sidebar: sidebar 
permalink: backup/anf-cba-overview-of-installation-and-configuration-steps.html 
keywords: bluexp, hana host, backup user, hana system database 
summary: 本节介绍此解决方案 的所有组件的安装和配置。 
---
= 安装和配置步骤概述
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./../media/


link:anf-cba-cloud-backup-for-applications-architecture.html["先前版本：Cloud Backup for Applications架构。"]

[role="lead"]
所需的安装和配置步骤可分为三个方面。

* 安装和配置NetApp BlueXP组件。
+
必须在初始设置数据保护解决方案 期间执行一次。

* HANA主机和数据库的准备步骤。
+
必须对每个HANA数据库执行此操作、此操作应受CBA保护。

* Cloud Backup for Applications中的配置步骤。
+
必须对每个HANA数据库执行此操作、此操作应受CBA保护。





== 安装和配置NetApp BlueXP组件

中介绍了NetApp BlueXP组件的安装和配置 https://docs.netapp.com/us-en/cloud-manager-backup-restore/concept-protect-cloud-app-data-to-cloud.html["保护您的云原生应用程序数据| NetApp文档"^]。

. 注册到BlueXP并设置NetApp帐户。
. 在Azure vNet中部署BlueXP连接器。
. 在BlueXP中为Azure NetApp Files 创建工作环境。


image:anf-cba-image5.png["此图显示了本节所述的解决方案 架构。"]



== HANA主机和数据库的准备步骤

. 在HANA主机上安装Java 11。必须在HANA数据库主机上安装Java 11 (64位) Oracle Java或OpenJDK。
. 在HANA主机上部署CBA HANA插件、如中所述 link:https://docs.netapp.com/us-en/cloud-manager-backup-restore/task-deploy-snapcenter-plugin-for-sap-hana.html["部署适用于SAP HANA的Cloud Backup for Applications插件| NetApp文档"]。
. 在HANA系统数据库中创建一个备份用户、如下一章所述。




== Cloud Backup for Applications中的配置步骤

. 将HANA主机添加到Cloud Backup for Applications。
+
.. HANA用户存储密钥配置。
.. 存储占用空间配置。


. 为HANA系统创建和分配备份策略。
+
.. 基于Snapshot的备份操作。
.. 基于文件的备份操作。


. 配置非数据卷备份操作。
+
.. 存储占用空间配置。
.. 创建并分配备份策略。


. 配置全局非数据卷备份操作。
+
.. 系统详细信息配置。
.. 存储占用空间配置。
.. 创建并分配备份策略。




接下来的章节将详细介绍Cloud Backup for Applications的配置步骤。



== 在HANA系统数据库中创建备份用户

NetApp建议在HANA数据库中配置一个专用数据库用户、以便使用CBA运行备份操作。第二步、为此备份用户配置了SAP HANA用户存储密钥、此用户存储密钥将用于配置Cloud Backup for Applications SAP HANA插件。下图显示了可用于创建备份用户的SAP HANA Studio。

所需权限如下：

* 备份管理员
* 目录读取
* 数据库备份管理员
* 数据库恢复操作员


对于SAP HANA MDC系统、您必须在系统数据库中创建用户、因为系统和租户数据库的所有备份命令均使用系统数据库执行。

image:anf-cba-image10.png["此屏幕截图显示了在系统数据库中创建用户的位置。"]



== 将HANA系统添加到Cloud Backup for Application

. 在BlueXP中、选择*保护*>*备份和恢复*>*应用程序*
+
image:anf-cba-image11.png["此屏幕截图显示了蓝XP画、其中显示了正确的应用程序路径。"]

. 下面的屏幕截图显示了添加第一个HANA系统时的工作流。如果已将系统添加到Cloud Backup for Applications中、则初始屏幕将显示一个信息板视图、其中包含一个*添加系统*按钮、用于添加其他HANA系统。在这种情况下、第一步是步骤5。单击*发现应用程序*。
+
image:anf-cba-image12.png["此屏幕截图显示了添加第一个HANA系统时的工作流。"]

. 单击*云原生*。
+
image:anf-cba-image13.png["此屏幕截图显示了Hybrid vs Cloud Native Selection页面。"]

. 单击* SAP HANA *。
+
image:anf-cba-image14.png["此屏幕截图显示了Hybrid vs Cloud Native Selection页面。"]

. 在System Details屏幕中、选择系统类型：HANA单容器或多租户数据库容器。提供HANA系统的SID并输入自由文本作为系统名称。
+
以下屏幕截图显示了SAP HANA系统PR1的配置。

+
image:anf-cba-image15.png["此屏幕截图显示了SAP HANA系统PR1的配置。"]

. 单击*添加插件主机*以添加HANA数据库主机。通常使用主机名。IP地址同样有效。Port `8145` 是安装在HANA数据库主机上的HANA插件的默认端口。如果在插件安装期间未进行任何更改、则默认端口有效。
+

NOTE: 对于HANA多主机系统、只需添加运行系统数据库的主机即可。

+
image:anf-cba-image16.png["此屏幕截图显示了\"Add-Plug-in Host Selection\"屏幕。"]

. 要添加HANA数据库用户存储密钥、请单击*添加用户存储密钥*。
+
输入用于为 HANA 数据库配置用户存储密钥的信息。您可以提供任何名称作为密钥名称。系统详细信息包括使用 hdbsql. 客户端与系统数据库通信的 IP 地址和端口。对于SAP HANA MDC系统、请输入port `3<instanceNo>13` 是用于通过SQL访问系统数据库的标准端口。

+
您必须在先前配置的系统数据库中提供数据库用户的用户名和密码。Cloud Backup for Applications会使用此信息自动创建用户存储密钥、并使用此密钥与HANA数据库进行通信。

+
image:anf-cba-image17.png["此屏幕截图显示了添加用户存储密钥选择屏幕。"]

. 在HANA主机上、您可以通过执行以下命令来检查密钥是否正常工作：
+
....
pr1adm@vm-pr1:/usr/sap/PR1/HDB01> hdbuserstore list
DATA FILE       : /usr/sap/PR1/pr1adm/.hdb/vm-pr1/SSFS_HDB.DAT
KEY FILE        : /usr/sap/PR1/pr1adm/.hdb/vm-pr1/SSFS_HDB.KEY
KEY PR1KEY
  ENV : 10.0.1.20:30113
  USER: SNAPSHOT
KEY PR1SAPDBCTRL
  ENV : vm-pr1:30113
  USER: SAPDBCTRL
pr1adm@vm-pr1:/usr/sap/PR1/HDB01> hdbsql -U PR1KEY
Welcome to the SAP HANA Database interactive terminal.
Type:  \h for help with commands
       \q to quit
hdbsql SYSTEMDB=>
....
. 单击*下一步*完成系统详细信息配置。
+
image:anf-cba-image18.png["此屏幕截图显示了System Details屏幕。"]

. 单击*添加存储*以配置HANA数据库的存储占用空间。
+
image:anf-cba-image19.png["此屏幕截图显示了\"存储占用空间\"屏幕上的\"添加存储\"按钮。"]

. 输入 HANA 系统存储卷的信息。
. 选择用于HANA系统的ANF卷的工作环境和NetApp帐户。选择HANA系统的数据卷。在我们的示例中、这是 `PR1_data_mnt00001`。
+

NOTE: 对于 SAP HANA 多主机系统，您必须选择属于该系统的所有 HANA 主机的数据卷。

+
image:anf-cba-image20.png["此屏幕截图显示了添加存储占用空间选择屏幕。"]

. 单击*下一步*以添加存储占用空间。
+
image:anf-cba-image21.png["此屏幕截图显示了如何添加存储占用空间。"]

. 查看配置并单击*添加系统*。
+
image:anf-cba-image22.png["此屏幕截图显示了如何添加存储系统。"]

+
image:anf-cba-image23.png["此屏幕截图显示了结果。"]



HANA系统现在已添加到Cloud Backup for Applications中。下一步、您必须配置备份操作。

image:anf-cba-image24.png["此屏幕截图显示了在何处配置备份操作。"]

link:anf-cba-create-backup-policies.html["下一步：创建备份策略。"]
